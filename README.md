# AutoOrganize - Minecraft Spigot 自动整理插件

## 功能概述

AutoOrganize 是一个 Minecraft Spigot 插件，实现了智能的物品自动整理系统。玩家可以通过简单的命令打开一个整理界面，将需要整理的物品放入其中，插件会自动将这些物品分配到附近的容器中。

## 核心功能

### 1. 自定义GUI界面
- 提供6行（54格）的自定义物品栏界面
- 玩家可以将任意物品放入界面中的任意格子
- 支持物品栏的打开、关闭事件监听

### 2. 智能整理算法
- **范围检测**：在指定实体周围一定范围内搜索所有容器（箱子、木桶、潜影盒等）
- **物品匹配**：检查每个容器中已存在的物品类型
- **智能分配**：将物品放入已经包含相同物品类型的容器中
- **剩余处理**：无法放入的物品返回玩家背包，背包满时掉落在脚下

### 3. 同步分批处理
- 使用同步任务避免线程安全问题
- 分批扫描容器和处理物品，避免服务器卡顿
- 配置每tick扫描方块数量
- 实时显示整理进度

### 4. 视觉效果系统
- 每个成功整理的物品都会生成飞行动画
- 使用ItemDisplay实体从中心位置飞向目标容器
- 直线飞行轨迹，带有减速效果和轻微弧形
- 飞行过程中物品会旋转，增强视觉效果
- 到达目标后自动清理实体

### 5. 插件集成支持
- **CoreProtect集成**：自动记录所有容器操作，支持回滚和查询
- **LockettePro集成**：检查容器锁定状态，只整理到有权限的容器
- 软依赖设计，无需强制安装这些插件

## 使用方法

### 命令格式
```
/organize <坐标> <范围>
```

### 参数说明
- `<坐标>`：搜索容器的中心坐标位置
- `<范围>`：搜索容器的范围（方块数）

### 使用示例
```
/organize ~ ~ ~ 10
```
以当前位置为中心，在10格范围内搜索容器进行整理

### 使用流程
1. 执行命令打开整理界面
2. 将需要整理的物品放入界面中
3. 关闭界面，系统自动开始整理
4. 查看整理进度和结果

## 支持的容器类型

- 箱子 (Chest)
- 陷阱箱 (Trapped Chest)  
- 木桶 (Barrel)
- 各种颜色的潜影盒 (Shulker Box)

## 整理逻辑

### 物品分配策略
1. **优先匹配**：寻找已经包含相同物品类型的容器
2. **堆叠优先**：优先填满现有物品堆叠
3. **空格填充**：在匹配容器的空格子中放置新物品
4. **容量限制**：不会放入空容器，只放入已有相同物品的容器

### 剩余物品处理
1. 优先返回玩家背包
2. 背包空间不足时在玩家脚下掉落
3. 显示整理统计信息

## 技术特性

### 同步分批处理
- 每tick扫描300个方块（容器搜索阶段）
- 每tick处理5种物品（整理阶段）
- 使用同步任务确保线程安全
- 避免服务器性能影响

### 视觉效果系统
- ItemDisplay实体飞行动画
- 30tick飞行持续时间，平滑减速
- 缓出曲线实现自然的减速效果
- 轻微弧形轨迹增强视觉体验
- 物品旋转动画

### 插件集成
- CoreProtect自动记录容器操作
- LockettePro权限检查
- 软依赖设计，兼容性强

### 错误处理
- 处理容器被破坏的情况
- 处理玩家离线的情况
- 提供详细的错误信息

### 进度反馈
- 实时显示整理进度百分比
- 显示已处理和总计物品数量
- 完成后显示整理统计

## 安装方法

1. 将编译好的 `AutoOrganize.jar` 文件放入服务器的 `plugins` 文件夹
2. 重启服务器或使用 `/reload` 命令
3. 插件将自动启用

## 权限设置

目前插件使用默认权限，所有玩家都可以使用整理功能。

## 开发信息

- **版本**: 1.0
- **API版本**: 1.21
- **主类**: `org.etwxr9.autoorganize.AutoOrganize`
- **依赖**: Paper API 1.21.1

## 代码结构

- `AutoOrganize.java` - 主插件类，处理命令注册和插件集成
- `OrganizeGUIManager.java` - GUI管理类，处理界面交互
- `OrganizeAlgorithm.java` - 整理算法类，实现物品分配逻辑
- `OrganizeTask.java` - 同步任务类，处理分批执行
- `ItemFlyingEffect.java` - 视觉效果类，处理物品飞行动画
- `CoHook.java` - CoreProtect集成类，处理容器操作记录
- `LocketteProHook.java` - LockettePro集成类，处理容器权限检查

## 注意事项

1. 确保目标实体周围有足够的容器
2. 容器中需要已经存在相同类型的物品才会被选中
3. 整理过程是异步的，请耐心等待完成
4. 建议在容器较多时适当增加范围参数

## 更新日志

### v1.0
- 初始版本发布
- 实现基础的自动整理功能
- 支持GUI界面操作
- 异步处理避免卡顿
